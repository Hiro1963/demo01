<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Touch Enikki Ver.0106</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <link rel="stylesheet" href="css/base.css" />
  <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
  <script>
    var stage
	var DyShpWhen = [];
 	var DyShpWhere = [];
 	var DyShpDraw = [];
    var DyMvShape
    var MoveStarted = false;
    var text1;
    var btn1,btn2,btn3,btn4,btn5

    window.addEventListener("load", main);

    function main() {
      // 読み込みが終わってから初期化
      init();
      DyWord();
      DyButton();
      DyShapeDef();
    }

    function init() {
      // ステージを作成
      stage = new createjs.Stage("myCanvas");

      // タッチ操作をサポートしているブラウザーならば
      if (createjs.Touch.isSupported() == true) {
        // タッチ操作を有効にします。
        createjs.Touch.enable(stage)
      }
      stage.enableMouseOver();
      
      text1 = new createjs.Text("init", "24px serif", "DarkRed");
      stage.addChild(text1);
      
    }

    function DyWord() {
      // tick イベントを登録する
      createjs.Ticker.addEventListener("tick", handleTick);

      function handleTick(event) {
	    if (true == MoveStarted) {
	        // シェイプをマウスに追随させる
	        if (stage.mouseY > 50) {
		        DyMvShape.x = stage.mouseX;
		        DyMvShape.y = stage.mouseY;
	        }
	    }

        // 画面を更新する
        stage.update();
      }
    }

    function DyShapeRst() {
	    DyShpWhen[0].x = 15;
	    DyShpWhen[0].y = 325;
	    DyShpWhen[1].x = 100;
	    DyShpWhen[1].y = 325;
	    
	    DyShpWhere[0].x = 15;
	    DyShpWhere[0].y = 325;
	    DyShpWhere[1].x = 100;
	    DyShpWhere[1].y = 325;
    }

    function DyShapeDef() {
		// オブジェクト(WHEN)の作成
	    var Dyshape1 = new createjs.Bitmap("star.png");
	    Dyshape1.x = 15;
	    Dyshape1.y = 325;
	    Dyshape1.name = 'WHEN,TODAY';
	    DyShpWhen.push(Dyshape1);

	    var Dyshape2 = new createjs.Bitmap("star2.png");
	    Dyshape2.x = 100;
	    Dyshape2.y = 325;
	    Dyshape2.name = 'WHEN,YESTERDAY';
	    DyShpWhen.push(Dyshape2);

		// オブジェクト(WHERE)の作成
	    var Dyshape1 = new createjs.Bitmap("star3.png");
	    Dyshape1.x = 15;
	    Dyshape1.y = 325;
	    Dyshape1.name = 'WHERE,POOL';
	    DyShpWhere.push(Dyshape1);

	    var Dyshape2 = new createjs.Bitmap("star4.png");
	    Dyshape2.x = 100;
	    Dyshape2.y = 325;
	    Dyshape2.name = 'WHERE,SEA';
	    DyShpWhere.push(Dyshape2);

		// イベントを登録
		for (var i=0; i<DyShpWhen.length; i++) {
			DyShpWhen[i].addEventListener("pressup", handlePressUp);
			DyShpWhen[i].addEventListener("pressmove", handlePressMove);
		}

		for (var i=0; i<DyShpWhere.length; i++) {
			DyShpWhere[i].addEventListener("pressup", handlePressUp);
			DyShpWhere[i].addEventListener("pressmove", handlePressMove);
		}

		// イベントを登録
		function handlePressMove(event) {
//			text1.text = "PressMove";
			// 押した時の処理を記述
		    if (false == MoveStarted) {
				DyMvShape = event.target;
				MoveStarted = true;
			}
		}

		function handlePressUp(event) {
//			text1.text = "PressUP";
 			// クリックされた時の処理を記述
		    if (true == MoveStarted) {
				MoveStarted = false;
		        // 絵にあるか？
				if (DyMvShape.y < 270 ) {
					for (var i=0; i<DyShpDraw.length; i++) {
						if(DyShpDraw[i].name == DyMvShape.name) {
							break;
						}
					}
					if (i == DyShpDraw.length) {
						DyShpDraw.push(DyMvShape);
					}
				}
				else {
					for (var i=0; i<DyShpDraw.length; i++) {
						if(DyShpDraw[i].name == DyMvShape.name) {
							DyShpDraw.splice(i, 1);
							break;
						}
					}
				}
			}
		}
    }

    function DyObjClearAll() {
		DyShpDraw.length = 0;
	}

    function DyObjClear5W() {
    
    	stage.removeChild(text1);

		for (var i=0; i<DyShpWhen.length; i++) {
			// 絵にあるものは残す
			for (var j=0; j<DyShpDraw.length; j++) {
				if (DyShpWhen[i].name == DyShpDraw[j].name) {
					break;
			    }
			}
		    if (j == DyShpDraw.length) {
		    	stage.removeChild(DyShpWhen[i]);
		    }
	    }

		for (var i=0; i<DyShpWhere.length; i++) {
			// 選択肢から絵にあるものは残す
			for (var j=0; j<DyShpDraw.length; j++) {
				if(DyShpWhere[i].name == DyShpDraw[j].name) {
					break;
			    }
			}
		    if (j == DyShpDraw.length) {
		    	stage.removeChild(DyShpWhere[i]);
		    }
	    }
    }

    function DyButton() {

      // ボタンを作成
      btn1 = createButton("WHEN", 93, 40, "#0275d8");
      btn1.x = 0;
      btn1.y = 270;
      stage.addChild(btn1);

      btn2 = createButton("WHERE", 93, 40, "#d9534f");
      btn2.x = 93.75;
      btn2.y = 270;
      stage.addChild(btn2);

      btn3 = createButton("WHO", 93, 40, "#5cb85c");
      btn3.x = 187.5;
      btn3.y = 270;
      stage.addChild(btn3);

      btn4 = createButton("WHAT", 93, 40, "#ff00ff");
      btn4.x = 281.25;
      btn4.y = 270;
      stage.addChild(btn4);

      // ボタンを作成
      btn5 = createButton("WRITE", 282, 40, "#0275d8");
      btn5.x = 0;
      btn5.y = 0;
      stage.addChild(btn5);

      // ボタンを作成
      btn6 = createButton("CLEAR", 91, 40, "#808080");
      btn6.x = 283;
      btn6.y = 0;
      stage.addChild(btn6);

      // イベントを登録
      btn1.addEventListener("click", handleClick1);
      btn2.addEventListener("click", handleClick2);
      btn3.addEventListener("click", handleClick3);
      btn4.addEventListener("click", handleClick4);
      btn5.addEventListener("click", handleClick5);
      btn6.addEventListener("click", handleClick6);

      function handleClick1(event) {
		// クリックされた時の処理を記述
		DySwBtn(1);
		DyObjClear5W();
		DyDrawRect();
		for (var i=0; i<DyShpWhen.length; i++) {
			stage.addChild(DyShpWhen[i]);
		}
      }
      function handleClick2(event) {
		// クリックされた時の処理を記述
		DySwBtn(2);
		DyObjClear5W();
		DyDrawRect();
		for (var i=0; i<DyShpWhere.length; i++) {
			stage.addChild(DyShpWhere[i]);
		}
      }
      function handleClick3(event) {
		// クリックされた時の処理を記述
		DySwBtn(3);
		DyObjClear5W();
		DyDrawRect();
      }
      function handleClick4(event) {
		// クリックされた時の処理を記述
		DySwBtn(4);
		DyObjClear5W();
		DyDrawRect();
      }
      function handleClick5(event) {
		// クリックされた時の処理を記述
		DySwBtn(5);
		DyObjClear5W();
		DyDrawRect();
		//日記を書く
		text1.text = "";
		text1.x = 10;
		text1.y = 325;
		for (var i=0; i<DyShpDraw.length; i++) {
			text1.text += DyShpDraw[i].name;
			text1.text += "\r";
		}
		stage.addChild(text1);
      }
      function handleClick6(event) {
		// クリックされた時の処理を記述
		DySwBtn(6);
		DyShapeRst();
		DyObjClearAll();
		DyObjClear5W();
		DyDrawRect();
      }

    }

	function DySwBtn(BtnNo) {
		if (1 != BtnNo) {
			btn1.getChildAt(0).visible = true;
			btn1.getChildAt(1).visible = false;
			btn1.getChildAt(2).color = "#0275d8";
		}

		if (2 != BtnNo) {
			btn2.getChildAt(0).visible = true;
			btn2.getChildAt(1).visible = false;
			btn2.getChildAt(2).color = "#d9534f";
		}

		if (3 != BtnNo) {
			btn3.getChildAt(0).visible = true;
			btn3.getChildAt(1).visible = false;
			btn3.getChildAt(2).color = "#5cb85c";
		}

		if (4 != BtnNo) {
			btn4.getChildAt(0).visible = true;
			btn4.getChildAt(1).visible = false;
			btn4.getChildAt(2).color = "#ff00ff";
		}

		if (5 != BtnNo) {
			btn5.getChildAt(0).visible = true;
			btn5.getChildAt(1).visible = false;
			btn5.getChildAt(2).color = "#0275d8";
		}

		if (6 != BtnNo) {
			btn6.getChildAt(0).visible = true;
			btn6.getChildAt(1).visible = false;
			btn6.getChildAt(2).color = "#808080";
		}
	}

	/**
	 * CreateJSのボタンを作成する関数です。
	 * この関数でボタンを作ったらステージに追加したり、クリックイベントを登録しましょう。
	 * @param {String} text ボタンのラベル文言です。
	 * @param {Number} width ボタンの横幅(単位はpx)です。
	 * @param {Number} height ボタンの高さ(単位はpx)です。
	 * @param {String} keyColor ボタンのキーカラーです。
	 * @returns {createjs.Container} ボタンの参照を返します。
	 */
	function createButton(text, width, height, keyColor) {

	  // ボタン要素をグループ化
	  var button = new createjs.Container();
	  button.name = text; // ボタンに参考までに名称を入れておく(必須ではない)
	  button.cursor = "pointer"; // ホバー時にカーソルを変更する

	  // 通常時の座布団を作成
	  var bgUp = new createjs.Shape();
	  bgUp.graphics
	          .setStrokeStyle(1.0)
	          .beginStroke(keyColor)
	          .beginFill("white")
	          .drawRoundRect(0.5, 0.5, width - 1.0, height - 1.0, 4);
	  button.addChild(bgUp);
	  bgUp.visible = true; // 表示する

	  // ロールオーバー時の座布団を作成
	  var bgOver = new createjs.Shape();
	  bgOver.graphics
	          .beginFill(keyColor)
	          .drawRoundRect(0, 0, width, height, 4);
	  bgOver.visible = false; // 非表示にする
	  button.addChild(bgOver);

	  // ラベルを作成
	  var label = new createjs.Text(text, "18px sans-serif", keyColor);
	  label.x = width / 2;
	  label.y = height / 2;
	  label.textAlign = "center";
	  label.textBaseline = "middle";
	  button.addChild(label);

	  // ロールオーバーイベントを登録
//	  button.addEventListener("mouseover", handleMouseOver);
//	  button.addEventListener("mouseout", handleMouseOut);
	  button.addEventListener("pressup", handlePressUp);
	  button.addEventListener("pressmove", handlePressMove);
	  function handlePressUp(event) {
//		text1.text = "pressup";
	    bgUp.visible = false;
	    bgOver.visible = true;
	    label.color = "white";
	  }

	  function handlePressMove(event) {
//		text1.text = "pressmove";
	    bgUp.visible = true;
	    bgOver.visible = false;
	    label.color = keyColor;
	  }

	  return button;
	}

	function DyDrawRect() {
	
		//Graphicsオブジェクトを作成する
	    var g = new createjs.Graphics();

		//線の色を指定
	    g.beginStroke("#00ffff");

		//塗りつぶしの色を作成
//	    g.beginFill("#ffffff");

		// 線の幅を指定
		g.setStrokeStyle(5);

		//四角を描く(x:0,y:0を左上角とした幅100px,高さ100pxの四角)
	    g.drawRoundRect(2,313,372,238,30);

		//Displayオブジェクトを作成
	    var shape=new createjs.Shape(g);

		//シェイプオブジェクトをステージに追加する
	    stage.addChild(shape);
     
	}



</script>
</head>
<body>
  <canvas id="myCanvas" width="375" height="560"></canvas>
</body>
</html>